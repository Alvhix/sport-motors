class Concesionario{constructor(e,o){this.nombre=e,this.direccion=o,this.stockCoches=new Array,this.stockActivo=new Array}obtenerStock(){var e=[],o=new XMLHttpRequest;o.onreadystatechange=function(){4===this.readyState&&200===this.status&&(e=this.responseText,Concesionario.prototype.guardarStock(e))},o.open("GET","includes/cargar.inc.php",!0),o.send()}guardarStock(e){localStorage.setItem("stockCoches",e)}cargarStock(){var e=JSON.parse(localStorage.getItem("stockCoches"));for(let o=0;o<e.length;o++)e[o]=new Coche(e[o].id,e[o].marca,e[o].modelo,e[o].kilometraje,e[o].precio,e[o].color,e[o].año,e[o].potencia,e[o].combustible);this.stockCoches=e,this.stockActivo=e}borrarStock(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status&&(localStorage.removeItem("stockCoches"),document.getElementById("formulario_mensajes").innerHTML="<div class='msg msg__success' id='mensaje-eliminar'>"+this.responseText+"</div>")},e.open("POST","includes/borrar.inc.php",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send("borrar=1")}restablecerStock(){this.stockActivo=this.stockCoches.slice(0)}}class Vehiculo{constructor(e,o,t,c,a){this.id=e,this.marca=o,this.modelo=t,this.kilometraje=c,this.precio=a}precioSinIva(e){return void 0===e&&(e=IVA),Math.round(this.precio-this.precio*e/100)}}class Coche extends Vehiculo{constructor(e,o,t,c,a,r,n,i,s){super(e,o,t,c,a),this.color=r,this.año=n,this.potencia=i,this.combustible=s}}const TABLACOCHE="tabla-coche",BUSQCOCHE="busqueda-coche",FORMCOCHE="formulario-coche",IVA=21;function visualizarCoches(e=TABLACOCHE){var o=concesionario.stockActivo;document.getElementById(e).innerHTML=function(e){var o,t=e;if(void 0!==t&&t.length>0){o="<table class='table table-bordered table-hover animated fadeIn'><thead class='thead-light text-center'><tr><th>Marca</th><th>Modelo</th><th>Color</th><th>Año</th><th>Potencia</th><th>Combustible</th><th>Kilometraje</th><th>Precio sin IVA</th><th>Precio</th></tr></thead><tbody class='text-center'>";for(var c=0;c<t.length;c++)o+="<tr class='coche' data-id='"+t[c].id+"'>",o+="<td>"+t[c].marca+"</td>",o+="<td>"+t[c].modelo+"</td>",o+="<td>"+t[c].color+"</td>",o+="<td>"+t[c].año+"</td>",o+="<td>"+t[c].potencia+"cv</td>",o+="<td>"+t[c].combustible+"</td>",o+="<td>"+t[c].kilometraje+"km</td>",o+="<td>"+t[c].precioSinIva(IVA)+"€</td>",o+="<td>"+t[c].precio+"€</td>",o+="</tr>";o+="</tbody></table>"}else o="<div class='alert alert-warning animated flash delay-1s fade show p-4 mt-4' role='alert'><div class='text-center'><h4 class='alert-heading text-center'>No se han encontrado coches, puede introducirlos <a href='formulario.php' style='text-decoration:none; font-size:100%'>aquí</a></h4></div></div>";return o}(o)}function ordenarCoches(e){var o=concesionario.stockActivo;if(o.length>0)switch(e){case"precio-":o.sort(function(e,o){return o.precio-e.precio||o.potencia-e.potencia});break;case"precio+":o.sort(function(e,o){return e.precio-o.precio||e.potencia-o.potencia});break;case"kilometraje-":o.sort(function(e,o){return o.kilometraje-e.kilometraje||o.precio-e.precio});break;case"kilometraje+":o.sort(function(e,o){return e.kilometraje-o.kilometraje||e.precio-o.precio});break;case"potencia-":o.sort(function(e,o){return o.potencia-e.potencia||o.precio-e.precio});break;case"potencia+":o.sort(function(e,o){return e.potencia-o.potencia||e.precio-o.precio});break;case"año-":o.sort(function(e,o){return o.año-e.año||o.precio-e.precio});break;case"año+":o.sort(function(e,o){return e.año-o.año||e.precio-o.precio});break;case"combustible":o.sort(function(e,o){var t=e.combustible.toLowerCase(),c=o.combustible.toLowerCase(),a=e.marca.toLowerCase(),r=o.marca.toLowerCase();return t<c?-1:t>c?1:a<r?-1:a>r?1:0});break;case"marca":o.sort(function(e,o){var t=e.marca.toLowerCase(),c=o.marca.toLowerCase(),a=e.modelo.toLowerCase(),r=o.modelo.toLowerCase();return t<c?-1:t>c?1:a<r?-1:a>r?1:0});break;default:return!1}concesionario.stockActivo=o,visualizarCoches(TABLACOCHE)}function busquedaCoche(){var e=[],o=!1,t=BUSQCOCHE,c=concesionario.stockCoches,a=document.forms["formulario-busqueda-coche"].marca.value,r=document.forms["formulario-busqueda-coche"].modelo.value;if(/^(?!\s*$).+/.test(a)&&""===r||"*"===r)c.forEach(t=>{a.toLowerCase()===t.marca.toLowerCase()&&(e.push(t),o=!0)});else{if(!/^(?!\s*$).+/.test(a)||!/^(?!\s*$).+/.test(r))return alert("¡Rellena al menos el campo marca para poder realizar la búsqueda!"),!1;c.forEach(t=>{a.toLowerCase()===t.marca.toLowerCase()&&r.toLowerCase()===t.modelo.toLowerCase()&&(e.push(t),o=!0)})}if(concesionario.stockActivo=e.slice(0),o)visualizarCoches(t);else{document.getElementById(t).innerHTML="<div class='alert alert-warning animated flash fade show p-4' role='alert'><div class='text-center'><h4>Advertencia</h4><h5 class='alert-heading'>No se han encontrado coincidencias, vuelva a intentarlo</h5></div></div>"}document.getElementById("boton-atras").innerHTML="<a href='busqueda.html'><button class='btn btn-secondary my-1'>Atrás</button></a>"}function contarVehiculos(){var e;numeroCoches=concesionario.stockCoches.length,e=0==numeroCoches?"<h6>Ningún coche</h6>":1==numeroCoches?"<h6>"+numeroCoches+" coche </h6>":"<h6>"+numeroCoches+" coches </h6>",document.getElementById("numero-vehiculos").innerHTML=e}function borrarTodo(){confirm("¿Estás seguro que desea vaciar el stock de vehículos?")&&concesionario.borrarStock()}function establecerValoresCoche(){var e=document.getElementById("filtro-coche-precio");let o=Math.max.apply(Math,concesionario.stockCoches.map(function(e){return e.precio})),t=Math.min.apply(Math,concesionario.stockCoches.map(function(e){return e.precio}));e.setAttribute("min",t),e.setAttribute("max",o),e.setAttribute("value",(t+o)/2);var c=document.getElementById("filtro-coche-kilometraje");let a=Math.max.apply(Math,concesionario.stockCoches.map(function(e){return e.kilometraje})),r=Math.min.apply(Math,concesionario.stockCoches.map(function(e){return e.kilometraje}));c.setAttribute("min",r),c.setAttribute("max",a),c.setAttribute("value",(r+a)/2);var n=document.getElementById("filtro-coche-potencia");let i=Math.max.apply(Math,concesionario.stockCoches.map(function(e){return e.potencia})),s=Math.min.apply(Math,concesionario.stockCoches.map(function(e){return e.potencia}));n.setAttribute("min",s),n.setAttribute("max",i),n.setAttribute("value",(s+i)/2),mostrarValoresSliderCoche()}function mostrarValoresSliderCoche(){var e=document.getElementById("valor-filtro-coche-precio"),o=document.getElementById("filtro-coche-precio");e.innerHTML=o.value+"€";var t=document.getElementById("valor-filtro-coche-kilometraje"),c=document.getElementById("filtro-coche-kilometraje");t.innerHTML=c.value+"km";var a=document.getElementById("valor-filtro-coche-potencia"),r=document.getElementById("filtro-coche-potencia");a.innerHTML=r.value+"cv"}function filtradoCoches(){var e=[],o=parseInt(document.getElementById("filtro-coche-precio").value),t=parseInt(document.getElementById("filtro-coche-kilometraje").value),c=parseInt(document.getElementById("filtro-coche-potencia").value),a=document.querySelector('input[name="combustible"]:checked').value;concesionario.stockCoches.forEach(r=>{"*"===a?r.precio<=o&&r.kilometraje<=t&&r.potencia<=c&&e.push(r):r.precio<=o&&r.kilometraje<=t&&r.potencia<=c&&r.combustible===a&&e.push(r)}),concesionario.stockActivo=e.slice(0),visualizarCoches(TABLACOCHE)}function restablecer(){concesionario.restablecerStock(),visualizarCoches(TABLACOCHE)}var concesionario=new Concesionario("Sport motors","Avenida del Alisal, 89, Palencia (España)");concesionario.obtenerStock(),concesionario.cargarStock();var coche1=new Coche("Audi","S3","Gris/plata",2018,300,"Gasolina",56039,55275),coche2=new Coche("Ford","Fiesta ST","Azul",2019,200,"Gasolina",25980,23590),coche3=new Coche("Hyundai","i30N","Blanco",2019,250,"Gasolina",23560,33950),coche4=new Coche("Renault","Megane RS","Amarillo",2019,280,"Gasolina",27970,32520),coche5=new Coche("Peugeot","508","Rojo",2018,131,"Diésel",34510,27450);!function(e,o){document.getElementById("info-concesionario").textContent=e+" | "+o}(concesionario.nombre,concesionario.direccion),function(){var e=new Date;document.getElementById("year").textContent=e.getFullYear()}();